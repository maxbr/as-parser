<html lang="en" ng-app="StarterApp">
<head>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/0.9.4/angular-material.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=RobotoDraft:300,400,500,700,400italic">
    <meta name="viewport" content="initial-scale=1"/>
    <title>Каталог</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-animate.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-aria.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angular_material/0.9.4/angular-material.min.js"></script>
    <style>
        .md-toolbar-tools h1 {
            font-size: inherit;
            font-weight: inherit;
            margin: inherit;
        }

        .gridListdemoBasicUsage md-grid-list {
            margin: 8px;
        }

        .gridListdemoBasicUsage .gray {
            background: #f5f5f5;
        }

        .gridListdemoBasicUsage md-grid-tile {
            transition: all 400ms ease-out 50ms;
        }

        a {
            text-decoration: none;
        }

        .autocompletedemoCustomTemplate .autocomplete-custom-template li {
            border-bottom: 1px solid #ccc;
            height: auto;
            padding-top: 8px;
            padding-bottom: 8px;
            white-space: normal; }

        .autocompletedemoCustomTemplate .autocomplete-custom-template li:last-child {
            border-bottom-width: 0;
        }

        .autocompletedemoCustomTemplate .autocomplete-custom-template .item-title,
        .autocompletedemoCustomTemplate .autocomplete-custom-template .item-metadata {
            display: block;
            line-height: 2;
        }

        .autocompletedemoCustomTemplate .autocomplete-custom-template .item-title md-icon {
            height: 18px;
            width: 18px;
        }
    </style>
    <script>
        var icons = [
                'http://image.flaticon.com/icons/svg/119/119358.svg',
                'http://image.flaticon.com/icons/svg/119/119325.svg',
                'http://image.flaticon.com/icons/svg/119/119344.svg',
                'http://image.flaticon.com/icons/svg/119/119363.svg',
                'http://image.flaticon.com/icons/svg/119/119352.svg'
        ];

        var app = angular.module('StarterApp', ['ngMaterial']);

        app.controller('AppCtrl', ['$scope', '$mdDialog', '$http', '$log', function ($scope, $mdDialog, $http, $log) {
            $scope.iconUrl = icons[Math.floor(Math.random() * icons.length)];

            $scope.loading = false;

            function myFunc(text) {
                $scope.loading = true;
                $http.get('/api/catalog?q=' + text)
                        .then(function(response) {
                            console.log(response.data);
                            $scope.items = response.data;
                            $scope.loading = false;
                        });
            };

            $scope.showAlert = function(ev) {
                alert('TBD');
            };

            // sandbox
            $scope.simulateQuery = false;
            $scope.isDisabled = false;
            $scope.repos = loadAll();
            $scope.querySearch = querySearch;
            $scope.selectedItemChange = selectedItemChange;
            $scope.searchTextChange = searchTextChange;

            function querySearch (query) {
                var results = query ? $scope.repos.filter( createFilterFor(query) ) : $scope.repos,
                        deferred;
                if ($scope.simulateQuery) {
                    deferred = $q.defer();
                    $timeout(function () { deferred.resolve( results ); }, Math.random() * 1000, false);
                    return deferred.promise;
                } else {
                    return results;
                }
            }

            function searchTextChange(text) {
                myFunc(text);
                $log.info('Text changed to ' + text);
            }

            function selectedItemChange(item) {
                $log.info('Item changed to ' + JSON.stringify(item));
            }

            function loadAll() {
                var repos = [
                    {
                        'name': 'Cyma Glock 18c',
                        'watchers': '12',
                        'shop': 'рога и копыта'
                    },
                    {
                        'name': 'LCT AK-47',
                        'watchers': '47',
                        'shop': 'ооо пупкин'
                    }
                ];
                return repos.map(function (repo) {
                    repo.value = repo.name.toLowerCase();
                    return repo;
                });
            }

            function createFilterFor(query) {
                var lowercaseQuery = angular.lowercase(query);

                return function filterFn(item) {
                    return (item.value.indexOf(lowercaseQuery) === 0);
                };
            }

        }]);
    </script>
</head>

<body layout="column" ng-controller="AppCtrl">

<md-toolbar layout="row">
    <div class="md-toolbar-tools">
        <div layout="row" flex="25">
            <md-button class="md-icon-button" aria-label="Icon">
                <md-icon md-svg-icon="{{iconUrl}}"></md-icon>
            </md-button>

            <h1 style="padding-top:10px">Каталог</h1>
        </div>

        <!--<md-input-container md-no-float class="md-accent" flex="50" style="padding-bottom:0px;margin-left:200px">-->
            <!--<md-icon style="color:white" class="material-icons">&#xE8B6;</md-icon>-->
            <!--<input ng-model="searchInput" ng-change="myFunc()" placeholder="Название" style="color:white;padding-left:25px;margin-left:5px">-->

            <!--<div layout="row" layout-sm="column">-->
            <form ng-submit="$event.preventDefault()" flex="45" style="margin-top:20px">
                <md-autocomplete
                        ng-disabled="isDisabled"
                        md-no-cache="noCache"
                        md-selected-item="selectedItem"
                        md-search-text-change="searchTextChange(searchText)"
                        md-search-text="searchText"
                        md-selected-item-change="selectedItemChange(item)"
                        md-items="item in querySearch(searchText)"
                        md-item-text="item.name"
                        md-min-length="0"
                        placeholder="Название"
                        md-menu-class="autocomplete-custom-template">
                    <md-item-template>
                        <span class="item-title">
                            <md-icon md-svg-icon="http://image.flaticon.com/icons/svg/119/119336.svg"></md-icon>
                            <span> {{item.name}} </span>
                        </span>
                        <span class="item-metadata">
                            <span class="item-metastat">
                              <strong>{{item.watchers}}</strong> просмотров
                            </span>
                            <span class="item-metastat">
                              <strong>{{item.shop}}</strong> магазин
                            </span>
                        </span>
                    </md-item-template>
                </md-autocomplete>
            </form>
            <!--</div>-->
        <!--</md-input-container>-->
        <span flex> </span>
        <md-button class="md-primary md-raised" ng-click="showAlert($event)">
            Обратная связь
        </md-button>

    </div>
</md-toolbar>

<div layout="row" flex>
    <md-sidenav layout="column" class="md-sidenav-left md-whiteframe-z2" md-component-id="left"
                md-is-locked-open="$mdMedia('gt-sm')">
        filters


    </md-sidenav>

    <div layout="column" flex id="content">
        <md-content layout="column" flex class="md-padding">

            <div style="height: 8px"><md-progress-linear ng-show="loading" md-mode="indeterminate"></md-progress-linear></div>

            <div class='md-padding' layout="row" layout-wrap>

                <div ng-show="!items.length">нет продуктов, удовлетворящих вашему запросу</div>

                <md-card style="width: 200px;" ng-repeat="item in items">
                    <a href="{{item.link}}"><img src="{{item.photo}}" class="md-card-image" alt=""></a>
                    <md-card-content>
                        <div><a href="{{item.link}}">{{item.title}}</a></div>
                        <div class="md-body-1">{{item.producer}}</div>
                        <div class="md-headline">{{item.price}} руб.</div>
                        <span class="md-caption">Магазин: airsoft-rus.ru</span>
                        <span class="md-caption">Просмотров: 12</span>
                    </md-card-content>
                    <!--<div class="md-actions" layout="row" layout-align="end center">-->
                        <!--<md-button>Save</md-button>-->
                        <!--<md-button>View</md-button>-->
                    <!--</div>-->
                </md-card>
            </div>

        </md-content>
    </div>
</div>

</body>
</html>
